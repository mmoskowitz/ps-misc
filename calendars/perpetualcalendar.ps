%!PS-Adobe-2.0
 %%Creator: Marc Moskowitz
 %%Title: perpetualcalendar.ps
 %%Pages: 1
 %%PageOrder: Ascend
 %%BoundingBox: 0 0 612 936
 %%DocumentPaperSizes: Legal
 %%EndComments

%%BeginProlog

/inch {72 mul} def

/gridside 20 def

/red {
    1 0 0 setrgbcolor
} def

/orange {
    1 0.5 0 setrgbcolor
} def

/yellow {
    0 0 1 0 setcmykcolor
} def

/green {
    0 0.66 0.2 setrgbcolor
} def

/blue {
    0.163 0.373 0.6 setrgbcolor
} def

/purple {
    0.5 0 0.5 setrgbcolor
} def

/magenta {
    0 1 0 0 setcmykcolor
} def

/cyan {
    1 0 0 0 setcmykcolor
} def

/green2 {
    1 0 1 0 setcmykcolor
} def

/violet {
    1 1 0 0 setcmykcolor
} def

/black {
    0 0 0 1 setcmykcolor
} def

/white {
    0 0 0 0 setcmykcolor
} def

/spotrad gridside 2.2 div def

/spot {
    gsave
    currentpoint translate
    newpath
    0 0 spotrad 0 360 arc
    gsave
    black stroke
    grestore
    fill
    grestore
} def

/symbolbase 30 def

/symbolscale {
    gridside 30 div dup scale
} def


/sun {
    gsave
    currentpoint translate
    symbolscale
    1 5 div dup scale
    7 setlinewidth
    newpath
    0 0 50 0 360 arc
    stroke
    newpath
    0 0 7 0 360 arc
    fill
    grestore
} def

/moon {
    /angle 2 5 sqrt atan def
    gsave
    currentpoint translate
    symbolscale
    6.25 0 translate
    180 rotate
    1 5 div dup scale
    7 setlinewidth
    newpath
    0 0 50 -90 90 arc
    -25 5 sqrt mul 0 75 angle angle -1 mul arcn
    stroke
    grestore
} def

/mercury {
    gsave
    currentpoint translate
    symbolscale
    1 5 div dup scale
    0 -15 translate
    7 setlinewidth
    newpath
    25 75 moveto
    0 75 25 0 -90 arcn
    0 25 25 90 450 arc
    0 75 25 270 180 arcn
    0 0 moveto
    0 -50 lineto
    25 -25 moveto
    -25 -25 lineto
    stroke
    grestore    
} def

/venus {
    gsave
    currentpoint translate
    symbolscale
    1 5 div dup scale
    7 setlinewidth
    newpath
    0 0 moveto
    0 25 25 -90 270 arc
    0 -50 lineto
    25 -25 moveto
    -25 -25 lineto
    stroke
    grestore    
} def

/mars {
    gsave
    currentpoint translate
    symbolscale
    1 5 div dup scale
    7 setlinewidth
    newpath
    -12.5 -12.5 25 45 405 arc
    30 dup rlineto
    -25 0 rmoveto
    25 0 rlineto
    0 -25 rlineto
    stroke
    grestore    
} def

/jove {
    gsave
    currentpoint translate
    symbolscale
    1 5 div dup scale
    7 setlinewidth
    newpath
    -50 0 25 2 sqrt mul 60 -60 arcn
    66.6 0 rlineto
    -25 -25 rmoveto
    0 100 rlineto
    stroke
    grestore    
} def

/saturn {
    gsave
    currentpoint translate
    symbolscale
    3.125 0 translate
    1 5 div dup scale
    7 setlinewidth
    newpath
    0 37.5 moveto
    -50 0 rlineto
    25 25 rmoveto
    0 -62.5 rlineto
    0 0 25 180 -45 arcn
    25 2 sqrt mul 1.5 mul dup -1 mul 50 135 180 arc
    0 -12.5 rlineto
    stroke
    grestore    
} def

/colors [
    {red}
    {yellow}
    {green2}
    {cyan}
    {violet}
    {magenta}
    {white}
] def

/colornames [
    (ru\201)
    (fla)
    (ver)
    (cej)
    (blu)
    (ma\201)
    (bla)
] def

/colornamegrays [
    1
    0
    1
    1
    1
    1
    0
] def

/colorsize 9 def

/colorshow {
    /text exch def
    gsave
    colorsize stdfont
    text centershow
    grestore
} def

/dot {
    /colornum exch def
    colors colornum get exec
    spot
    gsave
    colornamegrays colornum get setgray
    3 argleading
    colornames colornum get colorshow
    grestore    
} def

/symbols [
    {sun}
    {moon}
    {mars}
    {mercury}
    {jove}
    {venus}
    {saturn}
] def


/symbol {
    /symnum exch def
    gsave
    black
    symbols symnum get exec
    grestore
} def

/tostring {
    /tsdata exch def
    tsdata 0 eq {
	(0)
    } {
	tsdata cvi tsdata ne %tsdata not an int
	tsdata 4 mul tsdata 4 mul cvi eq and { %1/4, 1/2, 3/4
	    /tsrem tsdata 4 mul cvi 4 mod def %remainder of 4
	    /tsival tsdata cvi tostring def %call on int
	    /ts4val tsival length 1 add string def %string for result
	    ts4val 0 tsival putinterval %put the int in
	    ts4val tsival length 187 tsrem add put %add tsrem+187 to string
	    ts4val %return tsval
	} {
	    tsdata 1000 ge { %tsdata over 1000
		tsdata 1000 mod
		tsdata 1000 div cvi
		/tstop exch tostring def
		/tsbottom exch tostring padnumstring def
		/tskval tstop length 4 add string def
		tskval 0 tstop putinterval
		tskval tstop length (,) putinterval
		tskval tstop length 1 add tsbottom putinterval
		tskval
	    }{
		/tsval 4 string def %basic case
		tsdata tsval cvs
	    } ifelse
	} ifelse
    } ifelse
} def

/padnumstring {
    /numstring exch def
    /pnsval 2 string def
    pnsval 0 (OO) putinterval
    pnsval 2 numstring length sub numstring putinterval
    pnsval
} def

/zeros2oscars { %string 
    /zval exch def
    /zlen zval length def
    /zero (0) 0 get def
    /oscar (O) 0 get def
    /oval zlen string def
    /oindex 0 def
    zval {
	/chr exch def
	chr zero eq {
	    oval oindex oscar put
	} {
	    oval oindex chr put
	} ifelse
	/oindex oindex 1 add def
    } forall
    oval
} def

/tshow {
    /tstring exch def
    {
	/c1 exch def
	/c0 exch def
	c1 (a) 0 get eq c1 (c) 0 get eq or
	c1 (e) 0 get eq c1 (g) 0 get eq or or
	c1 (o) 0 get eq c1 (q) 0 get eq or or
	c1 (s) 0 get eq
	or
	c0 (k) 0 get eq and
	{
	    (l) stringwidth pop -3 div 0 rmoveto
	} if
    } tstring kshow
} def


/nmod { % c0 c1 nmod num = how many ells to move back between c0 and c1
    /c1 exch def
    /c0 exch def
    %ascii values
    /aO (O) 0 get def %oscar, not zero
    /a1 (1) 0 get def
    /a4 (4) 0 get def
    /a6 (6) 0 get def
    /a7 (7) 0 get def
    c0 aO eq c1 aO eq and { %OO
	2
    } {
	c0 a1 eq c1 a1 eq or { %*1 or 1*
	    .5
	}{
	    c0 a7 eq c1 a4 eq c1 a6 eq or and { %74 or 76
		2 5 div
	    } {
		0
	    } ifelse
	} ifelse
    } ifelse
} def

/nshow {
    /nstring exch def
    /nzstring nstring zeros2oscars def
    {
	/c1 exch def
	/c0 exch def
	/nm c0 c1 nmod def
	%stroke width
	/ell (l) stringwidth pop def
	ell nm mul -1 mul 0 rmoveto
    } nzstring kshow
} def

/leading {
    0 gridside -5 div rmoveto
} def

/argleading {
    0 exch -1 mul rmoveto
} def

/centershow {
    /text exch def
    text stringwidth pop -2 div 0 rmoveto
    text show
} def

/centertshow {
    /text exch def
    text stringwidth pop -2 div 0 rmoveto
    text tshow    
} def

/centernshow {
    /text exch def
    text stringwidth pop -2 div 0 rmoveto
    %get the adjustment and move forward half of it
    text 0 get text 1 get nmod (l) stringwidth pop mul 2 div 0 rmoveto
    text nshow    
} def

/numshow {
    gsave
      4 argleading
      tostring padnumstring
      zeros2oscars
      centernshow
    grestore
} def

/numboldshow {
    /num exch def
    gsave
    .75 setgray
    spot
    grestore
    num numshow
} def

/monthshow {
    /mtext exch def
    gsave
    currentpoint translate
    monthsize stdfont
    /mwidth mtext stringwidth pop def
    mwidth -1 mul 0 moveto
    leading
    mtext show
    grestore
} def

%re-encode fonts:begin

/addesperantoglyphs {
    /to exch def
    /from exch def
    from findfont 
    dup length dict begin
    { 1 index /FID ne
      {def}
      {pop pop}
      ifelse
    } forall
    /Encoding ISOLatin1Encoding length array def
    ISOLatin1Encoding Encoding copy
    Encoding 128 /ubreve put
    Encoding 129 /gcircumflex put
    Encoding 130 /ccircumflex put
    Encoding 131 /hcircumflex put
    Encoding 132 /jcircumflex put
    Encoding 133 /scircumflex put
    Encoding 136 /Ubreve put
    Encoding 137 /Gcircumflex put
    Encoding 138 /Ccircumflex put
    Encoding 139 /Hcircumflex put
    Encoding 140 /Jcircumflex put
    Encoding 141 /Scircumflex put
    currentdict
    end
    to exch definefont pop
} def

/Helvetica-Bold /Helvetica-Bold-EO addesperantoglyphs
/Helvetica-Medium /Helvetica-Medium-EO addesperantoglyphs
/Futura-Bold /Futura-Bold-EO addesperantoglyphs
/Futura-Medium /Futura-Medium-EO addesperantoglyphs
/AvantGarde-Demi /AvantGarde-Demi-EO addesperantoglyphs
/AvantGarde-Book /AvantGarde-Book-EO addesperantoglyphs

/Font-Standard /Helvetica-Bold def
%re-encode fonts:end



/stdfont {
    /size exch def
    /AvantGarde-Demi-EO  findfont size scalefont setfont
} def

/textfont {
    /size exch def
    /AvantGarde-Book-EO  findfont size scalefont setfont
} def

/boldfont {
    /size exch def
    /Futura-Italic  findfont size scalefont setfont
} def

/newrow {
    /row row 1 add def
    /col 0 def
} def

/newtrow {
    /row row 2 3 div add def
    /col 0 def
} def

/nextcell {
    /col col 1 add def
    col 6 gt {
	newrow
    } if
} def

/nextrow {
    /row row 1 add def
    row 3 gt {
	/col col 1 add def
	/row 0 def
    } if
} def

/resetcell {
    /row 0 def
    /col 0 def
} def

/movetocell {
    gridside col mul gridside row -1 mul mul moveto
} def

/tnl {
 nshow
 newtrow movetocell
} def

/monthsize 11 def

/drawtitle {
    %title
    gsave
    0 gridside -2 mul translate
    24 stdfont
    gridside 7 5 add 1 sub mul 2 div 0 moveto
    (dumiljara kalendaro) centertshow
    
    grestore
} def

/drawyears {
    %years
    gsave
    gridside 5 mul 0 translate
    gsave
    gridside -0.5 mul dup -1 mul translate
    .5 setlinewidth
    newpath
    resetcell
    0 {
	movetocell
	/col col 1 add def
	0 gridside -22 mul rlineto
    } repeat
    stroke
    grestore
    
    resetcell
    0 1 99 {
	/year exch def
	movetocell
	12 stdfont
	year 4 mod 0 eq {
	    year 0 eq {
		gsave
		.75 setgray
		newpath
		0 0 spotrad -135 45 arc
		fill
		0 setgray
		newpath
		0 0 spotrad 0 360 arc
		stroke
		grestore
		year numshow
	    } {
		year numboldshow
	    } ifelse
	} {
	    year numshow
	} ifelse
	year 4 mod 3 eq {
	    nextcell
	} if
	nextcell
    } for
    grestore
} def

/drawcenturies {
    %centuries
    gsave
    /col 0 def
    
    /row 18 def
    movetocell
    currentpoint translate
    gsave
    gridside -0.5 mul dup -1 mul translate
    .5 setlinewidth
    newpath
    resetcell
    0 {
	movetocell
	/row row 1 add def
	gridside 10 mul 0 rlineto
    } repeat
    stroke
    grestore
    resetcell
    16 1 35 {
	/century exch def
	movetocell
	12 stdfont
	century 4 mod 0 eq {
	    gsave
	    currentpoint translate
	    .75 setgray
	    newpath
	    0 0 spotrad -135 45 arcn
	    fill
	    0 setgray
	    newpath
	    0 0 spotrad 0 360 arc
	    stroke
            grestore
	    century numshow
	} {
	    century numshow
	} ifelse
	nextrow
	
    } for
    
    drawyearcolors
    grestore
} def

/drawyearcolors {
 %year type markers
 gsave
  movetocell
  currentpoint translate
  resetcell
  /color 0 def
  0 1 3 {
      0 1 6 {
	  movetocell
	  color dot
	  /color color 1 add 7 mod def
	  nextcell
      } for
      /color color 5 add 7 mod def
  } for
 grestore
} def

/drawtitles {
    gsave %titles
    14 stdfont
    /col 4 def
    /row 8 def
    movetocell
    gsave
    currentpoint translate
    90 rotate
    0 0 moveto
    leading
    (jaro) centershow
    grestore
    /col 2 def
    /row 17 def
    movetocell
    (jarcento) centershow
    /col 8 def
    /row 22 def
    movetocell
    leading
    (jarkoloro) centertshow
    /col .5 def
    /row 27 def
    movetocell
    gsave
    currentpoint translate
    90 rotate
    0 0 moveto
    leading
    (monato) centershow
    grestore
    /col 8 def
    /row 31 def
    movetocell
    leading
    (1\252 semajntago) centershow
    /col 6 def
    /row 32.5 def
    movetocell
    6 textfont
    /smallprint1 (dezajno de Marc Moskowitz, algoritmo kaj aran\201o desegnita de KT) def
    smallprint1 centertshow
    /row 33 def
    movetocell
    /smallprint2 (redaktado esperanta de Enric Pineda kaj Raphael Das Gupta) def
    smallprint2 centertshow
    /row 33.5 def
    movetocell
    /smallprint3 (kalendara sistemo desegnita de Ludoviko Lilo kaj Kristoforo Klavo) def
    smallprint3 centertshow
    
    % movetocell
    % smallprint stringwidth pop 2 div 0 rmoveto
    % (go desegnita de KT) stringwidth pop -1 mul 0 rmoveto
    % leading
    % (\223) show
    
    grestore
} def

/drawdays {
    %days
    gsave
    /col 5 def
    /row 23 def
    movetocell
    currentpoint translate
    resetcell
    0 1 6 {
	movetocell
	dot
	nextcell
    } for
    0 1 48 {
	/day exch def
	movetocell
	day row sub 8 add 7 mod symbol
	nextcell
    } for
    grestore
} def

/drawmonths {
    %months
    gsave
    /col 4.5 def
    /row 24 def
    movetocell
    currentpoint translate
    resetcell
    (jan okt ) monthshow
    newrow
    movetocell
    gsave
    monthsize stdfont
    (jan apr jul ) stringwidth pop -1 mul 0 rmoveto
    (jan) stringwidth pop 2 div 0 rmoveto
    .75 setgray
    spot
    grestore
    (jan apr jul ) monthshow
    newrow
    movetocell
    (sep dec ) monthshow
    newrow
    movetocell
    (jun ) monthshow
    newrow
    movetocell
    (feb mar nov ) monthshow
    newrow
    movetocell
    gsave
    monthsize stdfont
    (feb aug ) stringwidth pop -1 mul 0 rmoveto
    (feb) stringwidth pop 2 div 0 rmoveto
    .75 setgray
    spot
    grestore
    (feb a\200g ) monthshow
    newrow
    movetocell
    (maj ) monthshow
    newrow
    grestore
} def

/drawguide {
    %instructions
    gsave
    /col 12 def
    /row 0 def
    movetocell
    currentpoint translate 
    resetcell
    10 textfont
    (\202i tiu kalendaro estas vere ) tnl
    (kalend-ar-o. \253kalendo\273 estis ) tnl
    (en Romio la esprimo por la unua ) tnl
    (tago de monato; kaj \202i tiu ) tnl
    (kalendaro montras la ) tnl
    (semajntagon de la unua tago de ) tnl
    (\202iu monato de la jaroj 1600 \201is ) tnl
    (3599, do la semajntagon de \202iu ) tnl
    (kalendo en tiu periodo.) tnl

    /col 3 def
    /row row .5 add def
    movetocell
    14 stdfont
    (instrukcioj) centertshow
    newrow movetocell

    10 textfont
    (disfendu la jarnumeron en la ) tnl
    (jarcenton kaj la jaron. sub la ) tnl
    (jaro kaj dekstre de la jarcento vi ) tnl
    (trovu la jarkoloron. se la koloro ) tnl
    (de la cirklo de la jaro estas griza, ) tnl
    (a\200 la duoncirkloj de la jaro kaj la ) tnl
    (jarcento estas grizaj, estas ) tnl
    (superjaro. trovu la monaton; pri ) tnl
    (superjaroj uzu la februaron a\200 la ) tnl
    (januaron en la griza cirklo. sub la ) tnl
    (jarkoloro kaj dekstre de la ) tnl
    (monato trovu la simbolon de la ) tnl
    (unua semajntago de la monato. ) tnl
    (la simboloj estas:) tnl

    /row row -.75 add def
    newrow nextcell movetocell
    1 symbol gridside 2 mul 3 div gridside -1 mul 5 div rmoveto (lundo) show
    newrow nextcell movetocell
    2 symbol gridside 2 mul 3 div gridside -1 mul 5 div rmoveto (mardo) show
    newrow nextcell movetocell
    3 symbol gridside 2 mul 3 div gridside -1 mul 5 div rmoveto (merkredo) show
    newrow nextcell movetocell
    4 symbol gridside 2 mul 3 div gridside -1 mul 5 div rmoveto (\204a\200do) show
    newrow nextcell movetocell
    5 symbol gridside 2 mul 3 div gridside -1 mul 5 div rmoveto (vendredo) show
    newrow nextcell movetocell
    6 symbol gridside 2 mul 3 div gridside -1 mul 5 div rmoveto (sabato) show
    newrow nextcell movetocell
    0 symbol gridside 2 mul 3 div gridside -1 mul 5 div rmoveto (diman\202o) show

    newtrow movetocell
    newtrow movetocell


    (ekzemple, se vi volus scii la ) tnl
    (semajntago de la kvara tago de ) tnl
    (februario de la jaro 1900, vi trovus ) tnl
    (la jarkoloron sub la jaro 00 kaj ) tnl
    (dekstre de la jarcento 19 kio estas ) tnl
    (flava cirklo. la jaro 00 havas ) tnl
    (duoncirklon grizan, sed la jarcento ) tnl
    (19 ne havas cirklon grizon, do 1900 ) tnl
    (ne estas superjaro. sub la flava ) tnl
    (cirklo pri la jarkoloro kaj dekstre ) tnl
    (de la monato februaro sen cirklo ) tnl
    (griza vi trovus la simbolo de ) tnl
    (Merkurio, do la unua tago de via ) tnl
    (februaro estas merkredo. sed vi ) tnl
    (volus la kvara tago de februaro ) tnl
    (kaj havus la unua, la kalendo. do ) tnl
    (vi adicius tri kaj vidus la kvara ) tnl
    (tago de februaro esti sabato.) tnl


    grestore
} def

%%EndProlog
%%Page: calendar-0

.5 inch 13.5 inch translate

%temp border
newpath
0 0 moveto
7.5 inch 0 rlineto
0 -13 inch rlineto
-7.5 inch 0 rlineto
closepath
%stroke

%set page origin
gridside 1.5 mul 0 translate
14 11 div dup scale

%cutline
gsave
newpath
0 0 moveto
gridside 9.75 mul 0 rmoveto
.5 inch -10.75 inch rmoveto
4 -2 inch rmoveto
0 12 inch rlineto
%stroke
grestore

drawtitle

0 gridside -3 mul translate

drawyears

drawcenturies

drawtitles

drawdays

drawmonths

0 gridside 2 mul translate

drawguide

showpage
